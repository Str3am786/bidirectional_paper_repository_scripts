
\newcommand{\cmark}{\text{\ding{51}}}
\newcommand{\xmark}{\text{\ding{55}}}

\newcommand{\Expect}{\mathbb{E}}
\newcommand{\Expectof}[1]{\mathbb{E} \left[ #1 \right] }
\newcommand{\norm}[1]{\left\Vert #1 \right\Vert}
\newcommand{\of}[1]{\left( #1 \right)}
\newcommand{\inverse}[1]{{#1}^{-1}}
\newcommand{\ident}{\mathbb{1}}

\newtheorem{theorem}{Theorem}

\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\rank}{rank}

\DeclareFontFamily{OT1}{pzc}{}
\DeclareFontShape{OT1}{pzc}{m}{it}{<-> s * [1.10] pzcmi7t}{}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

\newcommand{\KwDatatXX}[1]{}
%\newcolumntype{?}{!{\vrule width 1pt}}

\newcommand{\figlabel}[1]{\label{fig:#1}}
\newcommand{\figref}[1]{\ref{fig:#1}}
\newcommand{\seclabel}[1]{\label{sec:#1}}
\newcommand{\secref}[1]{\ref{sec:#1}}
\newcommand{\subseclabel}[1]{\label{subsec:#1}}
\newcommand{\subsecref}[1]{\ref{subsec:#1}}

\newcommand{\twoRowCell}[2]{{\begin{tabular}[c]{@{}c@{}} {#1}\\ {#2}\end{tabular}}}
\newcommand{\twoRowCellBf}[2]{{\begin{tabular}[c]{@{}c@{}} {\bf #1}\\ {\bf #2}\end{tabular}}}
\newcommand{\twoRowCellBfSM}[2]{{\begin{tabular}[c]{@{}c@{}} \small {\bf #1}\\ {\bf #2}\end{tabular}}}

\newcommand{\new}[1]{{ \color{blue} #1 }}
\newcommand{\myvector}[1]{{\begin{pmatrix} #1 \end{pmatrix}}}
\newcommand{\mymatrix}[1]{{\begin{pmatrix} #1 \end{pmatrix}}}
\newtheorem{mydef}{Definition}
\newtheorem{myprop}{Proposition}
\newtheorem{myproof}{Proof Sketch}
\newtheorem{mythe}{Theorem}
\newtheorem{myLemma}{Lemma}
\newcommand{\F}[1]{F_{\sigma_{min}}\left(#1\right)}
\newcommand{\minS}[1]{\lambda_{min} \left({#1}\right)}

\newtheorem{mytheorem}{Theorem}
\newtheorem{myRemark}{Remark}
\newcommand\ColorBox[3][olive]%
  {\text{\fcolorbox{#1}{white}{\parbox[b][]{#2}{\raggedright#3}}}}
  
% variable list
%   k represents camera time instant indices;
%   i represents feature/landmark indices
\newcommand{\tinst}{k}
\newcommand{\findx}{i}

% 0) Frames and overall system
\newcommand{\Rfm}{\mathpzc{R}}  % robot frame (camera frame)
\newcommand{\Wfm}{\mathpzc{W}}  % world frame
\newcommand{\Rfmk}{{\mathpzc{R}_{k-1}}} % robot frame (camera frame)
\newcommand{\Rfmkk}{{\mathpzc{R}_{k}}}% robot frame (camera frame)

\newcommand{\State}[1]{\mathbf{X}^\Wfm_{#1}}% system state vector 
\newcommand{\StateK}{\mathbf{X}^\Wfm_{k-1}}   % system state vector, time k
\newcommand{\StateKK}{\mathbf{X}^\Wfm_{k}}% system state vector, time k+1

\newcommand{\TimeSegment}{\mathcal{T}}  % time segment
\newcommand{\TimeSegmentK}{\mathcal{T}_{k-1}}   % time segment = [t_k, t_{k+1}
\newcommand{\TimeSegmentKK}{\mathcal{T}_{k}}  % time segment = (t_k, t_{k+1}]

% 1) variables related to camera and 6DOF motion
\newcommand{\dt}{\Delta t}  % time step
\newcommand{\CameraPosition}{\mathbf{r}^\Wfm_\Rfm}  % g^W_Cam 
\newcommand{\CameraQuater}{\mathbf{q}^\Wfm_\Rfm}% R^W_Cam at time k
\newcommand{\StateCameraK}{\mathbf{x}^\Wfm_{\Rfmk}} % camera 6DOF vector in world
\newcommand{\CameraPositionK}{\mathbf{r}^\Wfm_\Rfmk}% camera position in world
\newcommand{\CameraQuaterK}{\mathbf{q}^\Wfm_\Rfmk}  % camera quaternion in world
\newcommand{\CameraLinVelK}{\mathbf{v}^\Wfm_\Rfmk}  % camera linear velocity in world
\newcommand{\CameraAngVelK}{\mathbf{\omega}^\Rfm}   % camera angular velocity in robot frame
\newcommand{\StateCameraKK}{\mathbf{x}^\Wfm_\Rfmkk} % camera 6DOF state vector in world
\newcommand{\CameraPositionKK}{\mathbf{r}^\Wfm_\Rfmkk}  % camera position in world
\newcommand{\CameraQuaterKK}{\mathbf{q}^\Wfm_\Rfmkk}% camera quaternion in world
\newcommand{\CameraLinVelKK}{\mathbf{v}^\Wfm_\Rfmkk}% camera linear velocity in world
\newcommand{\CameraAngVelKK}{\mathbf{\omega}^\Rfm}  % camera angular velocity in robot frame

\newcommand{\CameraLinVelNoise}{\mathbf{V}^\Wfm}% linear velocity noise
%\newcommand{\CameraAngVelNoise}{\mathbf{\Omega}^\Rfm}   % linear velocity noise
\newcommand{\CameraAngVelNoise}{\mathbf{\varOmega}^\Rfm}

\newcommand{\Quater}{\mathbf{q}}
\newcommand{\RmatFromQuat}[1]{\mathbf{\mathrm{R}}{#1} }% R matrix from quaternion
\newcommand{\RmatFromQuatK}[1]{\mathbf{\mathrm{R}}_\Wfm^\Rfmk {#1} }% R matrix from quaternion
\newcommand{\QuatFromAngVelK}[1]{\mathbf{\rm{q}} {#1} } % R matrix from quaternion
%\newcommand{\Distort}[1]{\rm{Distort}\left[ #1 \right]}   % image distortion function

% 2) Measurements, Anchors, features
\newcommand{\FeaturePool}{\mathcal{F}}
\newcommand{\FeatureK}[1]{{}^{({#1})}\mathbf{p}^\Wfm_k} % 3D position vector of a featurein world
\newcommand{\FeatureKB}{\mathbf{p}^\Wfm_k}  % 3D position vector of a featurein world

\newcommand{\FeatureI}{\mathbf{p}^\Wfm_i} % 3D position vector of feature i in world

\newcommand{\FeatureIK}{{}^{(i)}\mathbf{p}^\Wfm_k} % 3D position vector of feature i in world
\newcommand{\FeatureIKK}{{}^{(i)}\mathbf{p}^\Wfm_{k+1}} % 3D position vector of feature i in world
\newcommand{\FeatureSetK}{\mathbf{P}^\Wfm_k} % set of 3D position vector of feature i in world
\newcommand{\FeatureSetKK}{\mathbf{P}^\Wfm_{k+1}} % set of 3D position vector of feature i in world
\newcommand{\FeatureIKInR}{{}^{(i)}\mathbf{p}^\Rfmk} % 3D position vector of feature i in camera frame
\newcommand{\FeatureIKKInR}{{}^{(i)}\mathbf{p}^\Rfmkk} % 3D position vector of feature i in camera frame

\newcommand{\AnchorK}[1]{{}^{({#1})}\mathbf{a}^\Wfm_k} % 3D position vector of a featurein world
\newcommand{\AnchorKB}{\mathbf{a}^\Wfm_k} % 3D position vector of a featurein world
\newcommand{\AnchorJK}{{}^{(j)}\mathbf{a}^\Wfm_k} % 3D position vector of feature i in world
\newcommand{\AnchorJKK}{{}^{(j)}\mathbf{a}^\Wfm_{k+1}} % 3D position vector of feature i in world
\newcommand{\AnchorSetK}{\mathbf{A}^\Wfm_k} % set of 3D position vector of feature i in world
\newcommand{\AnchorSetKK}{\mathbf{A}^\Wfm_{k+1}} % set of 3D position vector of feature i in world
\newcommand{\AnchorIKInR}{\mathbf{a}^\Rfmk_j} % 3D position vector of feature i in camera frame

\newcommand{\MeasureamentK}[1]{\mathbf{h}^\Rfmk_{#1} }   % projected image point of a feature  at time k
\newcommand{\MeasureamentIK}{\mathbf{h}^\Rfmk_i }   % projected image point of feature i at time k
\newcommand{\MeasureamentSetK}{\mathbf{h}^\Rfmk }   % projected image point of feature i\\
\newcommand{\MeasureamentKK}{\mathbf{h}^\Rfmkk }   % projected image point of a feature  at time k+1
\newcommand{\MeasureamentIKK}{\mathbf{h}^\Rfmkk_i }   % projected image point of feature i at time k+1
\newcommand{\MeasureamentSetKK}{\mathbf{h}^\Rfmkk }   % projected image point of feature i

\newcommand{\Nf}{{N_f}}  % number of features
\newcommand{\Na}{{N_a}}  % number of anchors

% 3) Excitation
\newcommand{\ExcitationK}{\mathbf{u}_k}% ??? Do we need to consier excitation here????
\newcommand{\ExcitationKK}{\mathbf{u}_{k+1}}
 
% 4) Models
\newcommand{\Modelf}{\mathbf{\mathrm{f}}}  % nonlinear process model
\newcommand{\Modelh}{\mathbf{\mathrm{h}^\Rfm}}  % nonlinear measurement model
\newcommand{\ModelhK}{\mathbf{\mathrm{h}^\Rfmk}}  % nonlinear measurement model at time k
\newcommand{\ModelhKK}{\mathbf{\mathrm{h}^\Rfmkk}}  % nonlinear measurement model at time kk

\newcommand{\ModelF}{\mathbf{\mathrm{F}^\Rfm}}  % linearized process model
\newcommand{\ModelFK}{\mathbf{\mathrm{F}^\Rfmk}}% linearized process model
\newcommand{\ModelFKK}{\mathbf{\mathrm{F}^\Rfmkk}}  % linearized process model

\newcommand{\ModelH}{\mathbf{\mathrm{H}^\Rfm}}  % linearized measurement model 
\newcommand{\ModelHK}{\mathbf{\mathrm{H}^\Rfmk}}% linearized measurement model 
\newcommand{\ModelHKK}{\mathbf{\mathrm{H}^\Rfmkk}}  % linearized measurement model 


% 5) Observability matrices
\newcommand{\TOM}[1]{\mathcal{Q}_{\rm TOM} ({#1})}
\newcommand{\SOM}[1]{\mathcal{Q}_{\rm SOM} ({#1})}
\newcommand{\LinOM}[1]{\mathcal{Q}_{\rm seg} {#1}}
\newcommand{\LmkOM}[1]{\mathcal{Q}_{\rm ft} {#1}}
\newcommand{\SubOM}[1]{\mathcal{Q}_{\rm sub} ({#1})}
\newcommand{\SimOM}[1]{\mathcal{Q}_{\rm sim} ({#1})}

\newcommand{\HH}{\mathbf{H}}
\newcommand{\FF}{\mathbf{F}}

\newcommand{\Dim}{\mathrm{Dim}}

\newcommand{\ObsIdx}{\psi}

\newcommand{\dhdr}[1]{\frac{\partial \MeasureamentK{{#1}}}{\partial \CameraPosition}}
\newcommand{\dhdq}[1]{\frac{\partial \MeasureamentK{{#1}}}{\partial \CameraQuater}}
\newcommand{\dhdf}[1] {\frac{\partial\MeasureamentK{{#1}}}{\partial \FeatureKB}}
\newcommand{\Ots}{\mathbf{0}_{2\times 6} }
\newcommand{\Ottr}{\mathbf{0}_{2\times 3} }

% 6) triplets, triplet selection
\newcommand{\Triplet}{\mathfrak{T}}
\newcommand{\TripletS}{\mathfrak{T}_s}
\newcommand{\TripletB}[1]{\mathfrak{T}_{#1}}

\newcommand{\TripletCand}{\mathfrak{T}'}
\newcommand{\TripletCandS}{\mathfrak{T}'_s}
\newcommand{\TripletCandB}[1]{\mathfrak{T}'_{#1}}
%
\newcommand{\ImgMatchScore}{S}
\newcommand{\TripleArea}{A}
\newcommand{\TripleAreaJ}{\TripleArea_{{<j_1,j_2,j_3>}}}

\newcommand{\InitMatchSet}{\mathbf{\{Z\}}}   % initial matched feature set, mismatches may exist
\newcommand{\InitMatchNumber}{N_\mathbf{Z}} % number of features in \InitMatchSet

% 7) EKF 
\newcommand{\EKFStatePrev}{\hat{\mathbf{X}}^\Wfm_{k-1|k-1}}%
\newcommand{\EKFStateNow}{\hat{\mathbf{X}}^\Wfm_{k|k-1}}
\newcommand{\EKFStateUpdated}{\hat{\mathbf{X}}^\Wfm_{k|k}}

\newcommand{\EKFMeas}[1]{\hat{\mathbf{h}}^\Rfmk_{#1}}   % projected image point of a feature  at time k

\newcommand{\MeasureSubSet}[1]{{}^{(\bf s)}\MeasureamentK{#1}}   % subset of measurements used for EKF partial updates

\newcommand{\EKFP}{\mathbf{P}}
\newcommand{\EKFG}{\mathbf{G}}
\newcommand{\EKFH}{\mathbf{H}}
\newcommand{\EKFR}{\mathbf{R}}
\newcommand{\EKFS}{\mathbf{S}}
\newcommand{\EKFQ}{\mathbf{Q}}
\newcommand{\EKFGain}{\mathbf{K}}

% 8) misc
\newcommand{\OrderAlg}[1]{\mathcal{O}({#1})}
\newcommand{\CamPrjMat}{\mathbf{\Pi}_{cam}}
\newcommand{\Card}[1]{\left| {#1} \right|}
\newcommand{\Cardina}{\mathbf{\aleph}}

\newcommand{\alert}[1]{{ \color{red} [*{#1}*]}}
\newcommand{\newadded}[1]{{{#1}}}
\newcommand{\SEThree}{SE\langle3\rangle}
\newcommand{\SLAMsys}{\mathfrak{S}_{\rm SLAM}(\FeaturePool ; \mathcal{G}_{\rm cam}^{\SEThree})}
\newcommand{\SLAMsysCand}{\mathfrak{S}_{\rm SLAM}(\FeaturePool' ; \mathcal{G}_{\rm cam}^{\SEThree})}
